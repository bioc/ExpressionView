<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>JPEGEncoder.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alivepdf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">encoding</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapData</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filters</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ColorMatrixFilter</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Point</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ByteArray</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alivepdf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">encoding</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitString</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alivepdf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">encoding</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IntBlock</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alivepdf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">encoding</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IntList</span>;
    <span class="ActionScriptASDoc">/**
     * Class that converts BitmapData into a valid JPEG
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">final</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">JPEGEncoder</span> <span class="ActionScriptBracket/Brace">{</span>

        <span class="ActionScriptComment">// Static table initialization
</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">ZigZagList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
             0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> 5<span class="ActionScriptOperator">,</span> 6<span class="ActionScriptOperator">,</span>14<span class="ActionScriptOperator">,</span>15<span class="ActionScriptOperator">,</span>27<span class="ActionScriptOperator">,</span>28<span class="ActionScriptOperator">,</span>
             2<span class="ActionScriptOperator">,</span> 4<span class="ActionScriptOperator">,</span> 7<span class="ActionScriptOperator">,</span>13<span class="ActionScriptOperator">,</span>16<span class="ActionScriptOperator">,</span>26<span class="ActionScriptOperator">,</span>29<span class="ActionScriptOperator">,</span>42<span class="ActionScriptOperator">,</span>
             3<span class="ActionScriptOperator">,</span> 8<span class="ActionScriptOperator">,</span>12<span class="ActionScriptOperator">,</span>17<span class="ActionScriptOperator">,</span>25<span class="ActionScriptOperator">,</span>30<span class="ActionScriptOperator">,</span>41<span class="ActionScriptOperator">,</span>43<span class="ActionScriptOperator">,</span>
             9<span class="ActionScriptOperator">,</span>11<span class="ActionScriptOperator">,</span>18<span class="ActionScriptOperator">,</span>24<span class="ActionScriptOperator">,</span>31<span class="ActionScriptOperator">,</span>40<span class="ActionScriptOperator">,</span>44<span class="ActionScriptOperator">,</span>53<span class="ActionScriptOperator">,</span>
            10<span class="ActionScriptOperator">,</span>19<span class="ActionScriptOperator">,</span>23<span class="ActionScriptOperator">,</span>32<span class="ActionScriptOperator">,</span>39<span class="ActionScriptOperator">,</span>45<span class="ActionScriptOperator">,</span>52<span class="ActionScriptOperator">,</span>54<span class="ActionScriptOperator">,</span>
            20<span class="ActionScriptOperator">,</span>22<span class="ActionScriptOperator">,</span>33<span class="ActionScriptOperator">,</span>38<span class="ActionScriptOperator">,</span>46<span class="ActionScriptOperator">,</span>51<span class="ActionScriptOperator">,</span>55<span class="ActionScriptOperator">,</span>60<span class="ActionScriptOperator">,</span>
            21<span class="ActionScriptOperator">,</span>34<span class="ActionScriptOperator">,</span>37<span class="ActionScriptOperator">,</span>47<span class="ActionScriptOperator">,</span>50<span class="ActionScriptOperator">,</span>56<span class="ActionScriptOperator">,</span>59<span class="ActionScriptOperator">,</span>61<span class="ActionScriptOperator">,</span>
            35<span class="ActionScriptOperator">,</span>36<span class="ActionScriptOperator">,</span>48<span class="ActionScriptOperator">,</span>49<span class="ActionScriptOperator">,</span>57<span class="ActionScriptOperator">,</span>58<span class="ActionScriptOperator">,</span>62<span class="ActionScriptOperator">,</span>63
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">YQTList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
            16<span class="ActionScriptOperator">,</span> 11<span class="ActionScriptOperator">,</span> 10<span class="ActionScriptOperator">,</span> 16<span class="ActionScriptOperator">,</span> 24<span class="ActionScriptOperator">,</span> 40<span class="ActionScriptOperator">,</span> 51<span class="ActionScriptOperator">,</span> 61<span class="ActionScriptOperator">,</span>
            12<span class="ActionScriptOperator">,</span> 12<span class="ActionScriptOperator">,</span> 14<span class="ActionScriptOperator">,</span> 19<span class="ActionScriptOperator">,</span> 26<span class="ActionScriptOperator">,</span> 58<span class="ActionScriptOperator">,</span> 60<span class="ActionScriptOperator">,</span> 55<span class="ActionScriptOperator">,</span>
            14<span class="ActionScriptOperator">,</span> 13<span class="ActionScriptOperator">,</span> 16<span class="ActionScriptOperator">,</span> 24<span class="ActionScriptOperator">,</span> 40<span class="ActionScriptOperator">,</span> 57<span class="ActionScriptOperator">,</span> 69<span class="ActionScriptOperator">,</span> 56<span class="ActionScriptOperator">,</span>
            14<span class="ActionScriptOperator">,</span> 17<span class="ActionScriptOperator">,</span> 22<span class="ActionScriptOperator">,</span> 29<span class="ActionScriptOperator">,</span> 51<span class="ActionScriptOperator">,</span> 87<span class="ActionScriptOperator">,</span> 80<span class="ActionScriptOperator">,</span> 62<span class="ActionScriptOperator">,</span>
            18<span class="ActionScriptOperator">,</span> 22<span class="ActionScriptOperator">,</span> 37<span class="ActionScriptOperator">,</span> 56<span class="ActionScriptOperator">,</span> 68<span class="ActionScriptOperator">,</span>109<span class="ActionScriptOperator">,</span>103<span class="ActionScriptOperator">,</span> 77<span class="ActionScriptOperator">,</span>
            24<span class="ActionScriptOperator">,</span> 35<span class="ActionScriptOperator">,</span> 55<span class="ActionScriptOperator">,</span> 64<span class="ActionScriptOperator">,</span> 81<span class="ActionScriptOperator">,</span>104<span class="ActionScriptOperator">,</span>113<span class="ActionScriptOperator">,</span> 92<span class="ActionScriptOperator">,</span>
            49<span class="ActionScriptOperator">,</span> 64<span class="ActionScriptOperator">,</span> 78<span class="ActionScriptOperator">,</span> 87<span class="ActionScriptOperator">,</span>103<span class="ActionScriptOperator">,</span>121<span class="ActionScriptOperator">,</span>120<span class="ActionScriptOperator">,</span>101<span class="ActionScriptOperator">,</span>
            72<span class="ActionScriptOperator">,</span> 92<span class="ActionScriptOperator">,</span> 95<span class="ActionScriptOperator">,</span> 98<span class="ActionScriptOperator">,</span>112<span class="ActionScriptOperator">,</span>100<span class="ActionScriptOperator">,</span>103<span class="ActionScriptOperator">,</span> 99
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">UVQTList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
            17<span class="ActionScriptOperator">,</span> 18<span class="ActionScriptOperator">,</span> 24<span class="ActionScriptOperator">,</span> 47<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span>
            18<span class="ActionScriptOperator">,</span> 21<span class="ActionScriptOperator">,</span> 26<span class="ActionScriptOperator">,</span> 66<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span>
            24<span class="ActionScriptOperator">,</span> 26<span class="ActionScriptOperator">,</span> 56<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span>
            47<span class="ActionScriptOperator">,</span> 66<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span>
            99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span>
            99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span>
            99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span>
            99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99<span class="ActionScriptOperator">,</span> 99
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">aasf</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
            1.0<span class="ActionScriptOperator">,</span> 1.387039845<span class="ActionScriptOperator">,</span> 1.306562965<span class="ActionScriptOperator">,</span> 1.175875602<span class="ActionScriptOperator">,</span>
            1.0<span class="ActionScriptOperator">,</span> 0.785694958<span class="ActionScriptOperator">,</span> 0.541196100<span class="ActionScriptOperator">,</span> 0.275899379
        <span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">aanscalesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
            <span class="ActionScriptComment">/* precomputed values scaled up by 14 bits */</span>
            16384<span class="ActionScriptOperator">,</span> 22725<span class="ActionScriptOperator">,</span> 21407<span class="ActionScriptOperator">,</span> 19266<span class="ActionScriptOperator">,</span> 16384<span class="ActionScriptOperator">,</span> 12873<span class="ActionScriptOperator">,</span>  8867<span class="ActionScriptOperator">,</span>  4520<span class="ActionScriptOperator">,</span>
            22725<span class="ActionScriptOperator">,</span> 31521<span class="ActionScriptOperator">,</span> 29692<span class="ActionScriptOperator">,</span> 26722<span class="ActionScriptOperator">,</span> 22725<span class="ActionScriptOperator">,</span> 17855<span class="ActionScriptOperator">,</span> 12299<span class="ActionScriptOperator">,</span>  6270<span class="ActionScriptOperator">,</span>
            21407<span class="ActionScriptOperator">,</span> 29692<span class="ActionScriptOperator">,</span> 27969<span class="ActionScriptOperator">,</span> 25172<span class="ActionScriptOperator">,</span> 21407<span class="ActionScriptOperator">,</span> 16819<span class="ActionScriptOperator">,</span> 11585<span class="ActionScriptOperator">,</span>  5906<span class="ActionScriptOperator">,</span>
            19266<span class="ActionScriptOperator">,</span> 26722<span class="ActionScriptOperator">,</span> 25172<span class="ActionScriptOperator">,</span> 22654<span class="ActionScriptOperator">,</span> 19266<span class="ActionScriptOperator">,</span> 15137<span class="ActionScriptOperator">,</span> 10426<span class="ActionScriptOperator">,</span>  5315<span class="ActionScriptOperator">,</span>
            16384<span class="ActionScriptOperator">,</span> 22725<span class="ActionScriptOperator">,</span> 21407<span class="ActionScriptOperator">,</span> 19266<span class="ActionScriptOperator">,</span> 16384<span class="ActionScriptOperator">,</span> 12873<span class="ActionScriptOperator">,</span>  8867<span class="ActionScriptOperator">,</span>  4520<span class="ActionScriptOperator">,</span>
            12873<span class="ActionScriptOperator">,</span> 17855<span class="ActionScriptOperator">,</span> 16819<span class="ActionScriptOperator">,</span> 15137<span class="ActionScriptOperator">,</span> 12873<span class="ActionScriptOperator">,</span> 10114<span class="ActionScriptOperator">,</span>  6967<span class="ActionScriptOperator">,</span>  3552<span class="ActionScriptOperator">,</span>
             8867<span class="ActionScriptOperator">,</span> 12299<span class="ActionScriptOperator">,</span> 11585<span class="ActionScriptOperator">,</span> 10426<span class="ActionScriptOperator">,</span>  8867<span class="ActionScriptOperator">,</span>  6967<span class="ActionScriptOperator">,</span>  4799<span class="ActionScriptOperator">,</span>  2446<span class="ActionScriptOperator">,</span>
             4520<span class="ActionScriptOperator">,</span>  6270<span class="ActionScriptOperator">,</span>  5906<span class="ActionScriptOperator">,</span>  5315<span class="ActionScriptOperator">,</span>  4520<span class="ActionScriptOperator">,</span>  3552<span class="ActionScriptOperator">,</span>  2446<span class="ActionScriptOperator">,</span>  1247
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">YTable</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">UVTable</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">fdtbl_YList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">fdtbl_UVList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initQuantTables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sf</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">t</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ZigZag</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZagList</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YQT</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">YQTList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">YQTList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptOperator">+</span>50<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>100<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">YQT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">YQT</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&lt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 1;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&gt;</span> 255<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 255;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">YTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">t</span>;
                <span class="ActionScriptDefault_Text">ZigZag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">ZigZag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZagList</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UVQT</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">UVQTList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">UVQT</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptOperator">+</span>50<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>100<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">UVQT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">UVQT</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&lt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 1;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&gt;</span> 255<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 255;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">UVTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">t</span>;
                <span class="ActionScriptDefault_Text">ZigZag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">ZigZag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZagList</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fdtbl_Y</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fdtbl_YList</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fdtbl_UV</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fdtbl_UVList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">fdtbl_Y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>  <span class="ActionScriptOperator">=</span>  <span class="ActionScriptDefault_Text">YTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&lt;&lt;</span> 3;
                <span class="ActionScriptDefault_Text">fdtbl_UV</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">UVTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&lt;&lt;</span> 3;
                <span class="ActionScriptDefault_Text">ZigZag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">fdtbl_Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fdtbl_Y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">fdtbl_UV</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fdtbl_UV</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_dc_luminance_nrcodesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>5<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_dc_luminance_valuesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>2<span class="ActionScriptOperator">,</span>3<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>5<span class="ActionScriptOperator">,</span>6<span class="ActionScriptOperator">,</span>7<span class="ActionScriptOperator">,</span>8<span class="ActionScriptOperator">,</span>9<span class="ActionScriptOperator">,</span>10<span class="ActionScriptOperator">,</span>11<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_ac_luminance_nrcodesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>2<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>3<span class="ActionScriptOperator">,</span>3<span class="ActionScriptOperator">,</span>2<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>3<span class="ActionScriptOperator">,</span>5<span class="ActionScriptOperator">,</span>5<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>0x7d<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_ac_luminance_valuesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
            0x01<span class="ActionScriptOperator">,</span>0x02<span class="ActionScriptOperator">,</span>0x03<span class="ActionScriptOperator">,</span>0x00<span class="ActionScriptOperator">,</span>0x04<span class="ActionScriptOperator">,</span>0x11<span class="ActionScriptOperator">,</span>0x05<span class="ActionScriptOperator">,</span>0x12<span class="ActionScriptOperator">,</span>
            0x21<span class="ActionScriptOperator">,</span>0x31<span class="ActionScriptOperator">,</span>0x41<span class="ActionScriptOperator">,</span>0x06<span class="ActionScriptOperator">,</span>0x13<span class="ActionScriptOperator">,</span>0x51<span class="ActionScriptOperator">,</span>0x61<span class="ActionScriptOperator">,</span>0x07<span class="ActionScriptOperator">,</span>
            0x22<span class="ActionScriptOperator">,</span>0x71<span class="ActionScriptOperator">,</span>0x14<span class="ActionScriptOperator">,</span>0x32<span class="ActionScriptOperator">,</span>0x81<span class="ActionScriptOperator">,</span>0x91<span class="ActionScriptOperator">,</span>0xa1<span class="ActionScriptOperator">,</span>0x08<span class="ActionScriptOperator">,</span>
            0x23<span class="ActionScriptOperator">,</span>0x42<span class="ActionScriptOperator">,</span>0xb1<span class="ActionScriptOperator">,</span>0xc1<span class="ActionScriptOperator">,</span>0x15<span class="ActionScriptOperator">,</span>0x52<span class="ActionScriptOperator">,</span>0xd1<span class="ActionScriptOperator">,</span>0xf0<span class="ActionScriptOperator">,</span>
            0x24<span class="ActionScriptOperator">,</span>0x33<span class="ActionScriptOperator">,</span>0x62<span class="ActionScriptOperator">,</span>0x72<span class="ActionScriptOperator">,</span>0x82<span class="ActionScriptOperator">,</span>0x09<span class="ActionScriptOperator">,</span>0x0a<span class="ActionScriptOperator">,</span>0x16<span class="ActionScriptOperator">,</span>
            0x17<span class="ActionScriptOperator">,</span>0x18<span class="ActionScriptOperator">,</span>0x19<span class="ActionScriptOperator">,</span>0x1a<span class="ActionScriptOperator">,</span>0x25<span class="ActionScriptOperator">,</span>0x26<span class="ActionScriptOperator">,</span>0x27<span class="ActionScriptOperator">,</span>0x28<span class="ActionScriptOperator">,</span>
            0x29<span class="ActionScriptOperator">,</span>0x2a<span class="ActionScriptOperator">,</span>0x34<span class="ActionScriptOperator">,</span>0x35<span class="ActionScriptOperator">,</span>0x36<span class="ActionScriptOperator">,</span>0x37<span class="ActionScriptOperator">,</span>0x38<span class="ActionScriptOperator">,</span>0x39<span class="ActionScriptOperator">,</span>
            0x3a<span class="ActionScriptOperator">,</span>0x43<span class="ActionScriptOperator">,</span>0x44<span class="ActionScriptOperator">,</span>0x45<span class="ActionScriptOperator">,</span>0x46<span class="ActionScriptOperator">,</span>0x47<span class="ActionScriptOperator">,</span>0x48<span class="ActionScriptOperator">,</span>0x49<span class="ActionScriptOperator">,</span>
            0x4a<span class="ActionScriptOperator">,</span>0x53<span class="ActionScriptOperator">,</span>0x54<span class="ActionScriptOperator">,</span>0x55<span class="ActionScriptOperator">,</span>0x56<span class="ActionScriptOperator">,</span>0x57<span class="ActionScriptOperator">,</span>0x58<span class="ActionScriptOperator">,</span>0x59<span class="ActionScriptOperator">,</span>
            0x5a<span class="ActionScriptOperator">,</span>0x63<span class="ActionScriptOperator">,</span>0x64<span class="ActionScriptOperator">,</span>0x65<span class="ActionScriptOperator">,</span>0x66<span class="ActionScriptOperator">,</span>0x67<span class="ActionScriptOperator">,</span>0x68<span class="ActionScriptOperator">,</span>0x69<span class="ActionScriptOperator">,</span>
            0x6a<span class="ActionScriptOperator">,</span>0x73<span class="ActionScriptOperator">,</span>0x74<span class="ActionScriptOperator">,</span>0x75<span class="ActionScriptOperator">,</span>0x76<span class="ActionScriptOperator">,</span>0x77<span class="ActionScriptOperator">,</span>0x78<span class="ActionScriptOperator">,</span>0x79<span class="ActionScriptOperator">,</span>
            0x7a<span class="ActionScriptOperator">,</span>0x83<span class="ActionScriptOperator">,</span>0x84<span class="ActionScriptOperator">,</span>0x85<span class="ActionScriptOperator">,</span>0x86<span class="ActionScriptOperator">,</span>0x87<span class="ActionScriptOperator">,</span>0x88<span class="ActionScriptOperator">,</span>0x89<span class="ActionScriptOperator">,</span>
            0x8a<span class="ActionScriptOperator">,</span>0x92<span class="ActionScriptOperator">,</span>0x93<span class="ActionScriptOperator">,</span>0x94<span class="ActionScriptOperator">,</span>0x95<span class="ActionScriptOperator">,</span>0x96<span class="ActionScriptOperator">,</span>0x97<span class="ActionScriptOperator">,</span>0x98<span class="ActionScriptOperator">,</span>
            0x99<span class="ActionScriptOperator">,</span>0x9a<span class="ActionScriptOperator">,</span>0xa2<span class="ActionScriptOperator">,</span>0xa3<span class="ActionScriptOperator">,</span>0xa4<span class="ActionScriptOperator">,</span>0xa5<span class="ActionScriptOperator">,</span>0xa6<span class="ActionScriptOperator">,</span>0xa7<span class="ActionScriptOperator">,</span>
            0xa8<span class="ActionScriptOperator">,</span>0xa9<span class="ActionScriptOperator">,</span>0xaa<span class="ActionScriptOperator">,</span>0xb2<span class="ActionScriptOperator">,</span>0xb3<span class="ActionScriptOperator">,</span>0xb4<span class="ActionScriptOperator">,</span>0xb5<span class="ActionScriptOperator">,</span>0xb6<span class="ActionScriptOperator">,</span>
            0xb7<span class="ActionScriptOperator">,</span>0xb8<span class="ActionScriptOperator">,</span>0xb9<span class="ActionScriptOperator">,</span>0xba<span class="ActionScriptOperator">,</span>0xc2<span class="ActionScriptOperator">,</span>0xc3<span class="ActionScriptOperator">,</span>0xc4<span class="ActionScriptOperator">,</span>0xc5<span class="ActionScriptOperator">,</span>
            0xc6<span class="ActionScriptOperator">,</span>0xc7<span class="ActionScriptOperator">,</span>0xc8<span class="ActionScriptOperator">,</span>0xc9<span class="ActionScriptOperator">,</span>0xca<span class="ActionScriptOperator">,</span>0xd2<span class="ActionScriptOperator">,</span>0xd3<span class="ActionScriptOperator">,</span>0xd4<span class="ActionScriptOperator">,</span>
            0xd5<span class="ActionScriptOperator">,</span>0xd6<span class="ActionScriptOperator">,</span>0xd7<span class="ActionScriptOperator">,</span>0xd8<span class="ActionScriptOperator">,</span>0xd9<span class="ActionScriptOperator">,</span>0xda<span class="ActionScriptOperator">,</span>0xe1<span class="ActionScriptOperator">,</span>0xe2<span class="ActionScriptOperator">,</span>
            0xe3<span class="ActionScriptOperator">,</span>0xe4<span class="ActionScriptOperator">,</span>0xe5<span class="ActionScriptOperator">,</span>0xe6<span class="ActionScriptOperator">,</span>0xe7<span class="ActionScriptOperator">,</span>0xe8<span class="ActionScriptOperator">,</span>0xe9<span class="ActionScriptOperator">,</span>0xea<span class="ActionScriptOperator">,</span>
            0xf1<span class="ActionScriptOperator">,</span>0xf2<span class="ActionScriptOperator">,</span>0xf3<span class="ActionScriptOperator">,</span>0xf4<span class="ActionScriptOperator">,</span>0xf5<span class="ActionScriptOperator">,</span>0xf6<span class="ActionScriptOperator">,</span>0xf7<span class="ActionScriptOperator">,</span>0xf8<span class="ActionScriptOperator">,</span>
            0xf9<span class="ActionScriptOperator">,</span>0xfa
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>3<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_valuesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>2<span class="ActionScriptOperator">,</span>3<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>5<span class="ActionScriptOperator">,</span>6<span class="ActionScriptOperator">,</span>7<span class="ActionScriptOperator">,</span>8<span class="ActionScriptOperator">,</span>9<span class="ActionScriptOperator">,</span>10<span class="ActionScriptOperator">,</span>11<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>2<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>2<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>3<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>7<span class="ActionScriptOperator">,</span>5<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>4<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>2<span class="ActionScriptOperator">,</span>0x77<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_valuesList</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
            0x00<span class="ActionScriptOperator">,</span>0x01<span class="ActionScriptOperator">,</span>0x02<span class="ActionScriptOperator">,</span>0x03<span class="ActionScriptOperator">,</span>0x11<span class="ActionScriptOperator">,</span>0x04<span class="ActionScriptOperator">,</span>0x05<span class="ActionScriptOperator">,</span>0x21<span class="ActionScriptOperator">,</span>
            0x31<span class="ActionScriptOperator">,</span>0x06<span class="ActionScriptOperator">,</span>0x12<span class="ActionScriptOperator">,</span>0x41<span class="ActionScriptOperator">,</span>0x51<span class="ActionScriptOperator">,</span>0x07<span class="ActionScriptOperator">,</span>0x61<span class="ActionScriptOperator">,</span>0x71<span class="ActionScriptOperator">,</span>
            0x13<span class="ActionScriptOperator">,</span>0x22<span class="ActionScriptOperator">,</span>0x32<span class="ActionScriptOperator">,</span>0x81<span class="ActionScriptOperator">,</span>0x08<span class="ActionScriptOperator">,</span>0x14<span class="ActionScriptOperator">,</span>0x42<span class="ActionScriptOperator">,</span>0x91<span class="ActionScriptOperator">,</span>
            0xa1<span class="ActionScriptOperator">,</span>0xb1<span class="ActionScriptOperator">,</span>0xc1<span class="ActionScriptOperator">,</span>0x09<span class="ActionScriptOperator">,</span>0x23<span class="ActionScriptOperator">,</span>0x33<span class="ActionScriptOperator">,</span>0x52<span class="ActionScriptOperator">,</span>0xf0<span class="ActionScriptOperator">,</span>
            0x15<span class="ActionScriptOperator">,</span>0x62<span class="ActionScriptOperator">,</span>0x72<span class="ActionScriptOperator">,</span>0xd1<span class="ActionScriptOperator">,</span>0x0a<span class="ActionScriptOperator">,</span>0x16<span class="ActionScriptOperator">,</span>0x24<span class="ActionScriptOperator">,</span>0x34<span class="ActionScriptOperator">,</span>
            0xe1<span class="ActionScriptOperator">,</span>0x25<span class="ActionScriptOperator">,</span>0xf1<span class="ActionScriptOperator">,</span>0x17<span class="ActionScriptOperator">,</span>0x18<span class="ActionScriptOperator">,</span>0x19<span class="ActionScriptOperator">,</span>0x1a<span class="ActionScriptOperator">,</span>0x26<span class="ActionScriptOperator">,</span>
            0x27<span class="ActionScriptOperator">,</span>0x28<span class="ActionScriptOperator">,</span>0x29<span class="ActionScriptOperator">,</span>0x2a<span class="ActionScriptOperator">,</span>0x35<span class="ActionScriptOperator">,</span>0x36<span class="ActionScriptOperator">,</span>0x37<span class="ActionScriptOperator">,</span>0x38<span class="ActionScriptOperator">,</span>
            0x39<span class="ActionScriptOperator">,</span>0x3a<span class="ActionScriptOperator">,</span>0x43<span class="ActionScriptOperator">,</span>0x44<span class="ActionScriptOperator">,</span>0x45<span class="ActionScriptOperator">,</span>0x46<span class="ActionScriptOperator">,</span>0x47<span class="ActionScriptOperator">,</span>0x48<span class="ActionScriptOperator">,</span>
            0x49<span class="ActionScriptOperator">,</span>0x4a<span class="ActionScriptOperator">,</span>0x53<span class="ActionScriptOperator">,</span>0x54<span class="ActionScriptOperator">,</span>0x55<span class="ActionScriptOperator">,</span>0x56<span class="ActionScriptOperator">,</span>0x57<span class="ActionScriptOperator">,</span>0x58<span class="ActionScriptOperator">,</span>
            0x59<span class="ActionScriptOperator">,</span>0x5a<span class="ActionScriptOperator">,</span>0x63<span class="ActionScriptOperator">,</span>0x64<span class="ActionScriptOperator">,</span>0x65<span class="ActionScriptOperator">,</span>0x66<span class="ActionScriptOperator">,</span>0x67<span class="ActionScriptOperator">,</span>0x68<span class="ActionScriptOperator">,</span>
            0x69<span class="ActionScriptOperator">,</span>0x6a<span class="ActionScriptOperator">,</span>0x73<span class="ActionScriptOperator">,</span>0x74<span class="ActionScriptOperator">,</span>0x75<span class="ActionScriptOperator">,</span>0x76<span class="ActionScriptOperator">,</span>0x77<span class="ActionScriptOperator">,</span>0x78<span class="ActionScriptOperator">,</span>
            0x79<span class="ActionScriptOperator">,</span>0x7a<span class="ActionScriptOperator">,</span>0x82<span class="ActionScriptOperator">,</span>0x83<span class="ActionScriptOperator">,</span>0x84<span class="ActionScriptOperator">,</span>0x85<span class="ActionScriptOperator">,</span>0x86<span class="ActionScriptOperator">,</span>0x87<span class="ActionScriptOperator">,</span>
            0x88<span class="ActionScriptOperator">,</span>0x89<span class="ActionScriptOperator">,</span>0x8a<span class="ActionScriptOperator">,</span>0x92<span class="ActionScriptOperator">,</span>0x93<span class="ActionScriptOperator">,</span>0x94<span class="ActionScriptOperator">,</span>0x95<span class="ActionScriptOperator">,</span>0x96<span class="ActionScriptOperator">,</span>
            0x97<span class="ActionScriptOperator">,</span>0x98<span class="ActionScriptOperator">,</span>0x99<span class="ActionScriptOperator">,</span>0x9a<span class="ActionScriptOperator">,</span>0xa2<span class="ActionScriptOperator">,</span>0xa3<span class="ActionScriptOperator">,</span>0xa4<span class="ActionScriptOperator">,</span>0xa5<span class="ActionScriptOperator">,</span>
            0xa6<span class="ActionScriptOperator">,</span>0xa7<span class="ActionScriptOperator">,</span>0xa8<span class="ActionScriptOperator">,</span>0xa9<span class="ActionScriptOperator">,</span>0xaa<span class="ActionScriptOperator">,</span>0xb2<span class="ActionScriptOperator">,</span>0xb3<span class="ActionScriptOperator">,</span>0xb4<span class="ActionScriptOperator">,</span>
            0xb5<span class="ActionScriptOperator">,</span>0xb6<span class="ActionScriptOperator">,</span>0xb7<span class="ActionScriptOperator">,</span>0xb8<span class="ActionScriptOperator">,</span>0xb9<span class="ActionScriptOperator">,</span>0xba<span class="ActionScriptOperator">,</span>0xc2<span class="ActionScriptOperator">,</span>0xc3<span class="ActionScriptOperator">,</span>
            0xc4<span class="ActionScriptOperator">,</span>0xc5<span class="ActionScriptOperator">,</span>0xc6<span class="ActionScriptOperator">,</span>0xc7<span class="ActionScriptOperator">,</span>0xc8<span class="ActionScriptOperator">,</span>0xc9<span class="ActionScriptOperator">,</span>0xca<span class="ActionScriptOperator">,</span>0xd2<span class="ActionScriptOperator">,</span>
            0xd3<span class="ActionScriptOperator">,</span>0xd4<span class="ActionScriptOperator">,</span>0xd5<span class="ActionScriptOperator">,</span>0xd6<span class="ActionScriptOperator">,</span>0xd7<span class="ActionScriptOperator">,</span>0xd8<span class="ActionScriptOperator">,</span>0xd9<span class="ActionScriptOperator">,</span>0xda<span class="ActionScriptOperator">,</span>
            0xe2<span class="ActionScriptOperator">,</span>0xe3<span class="ActionScriptOperator">,</span>0xe4<span class="ActionScriptOperator">,</span>0xe5<span class="ActionScriptOperator">,</span>0xe6<span class="ActionScriptOperator">,</span>0xe7<span class="ActionScriptOperator">,</span>0xe8<span class="ActionScriptOperator">,</span>0xe9<span class="ActionScriptOperator">,</span>
            0xea<span class="ActionScriptOperator">,</span>0xf2<span class="ActionScriptOperator">,</span>0xf3<span class="ActionScriptOperator">,</span>0xf4<span class="ActionScriptOperator">,</span>0xf5<span class="ActionScriptOperator">,</span>0xf6<span class="ActionScriptOperator">,</span>0xf7<span class="ActionScriptOperator">,</span>0xf8<span class="ActionScriptOperator">,</span>
            0xf9<span class="ActionScriptOperator">,</span>0xfa
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrcodesList</span>:<span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">std_tableList</span>:<span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">codevalue</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrcodes</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nrcodesList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_table</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_tableList</span>;
        <span class="ActionScriptComment">//    var pos_in_table:int = 0;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">HT</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>251<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">k</span> <span class="ActionScriptOperator">&lt;=</span> 16; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nr</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">&lt;=</span><span class="ActionScriptDefault_Text">nr</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">HT</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">std_table</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">codevalue</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">std_table</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_table</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
        <span class="ActionScriptComment">//            ++pos_in_table;
</span>                    <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">codevalue</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">nrcodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">codevalue</span><span class="ActionScriptOperator">&lt;&lt;=</span>1;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">HT</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YDC_HT</span>:<span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UVDC_HT</span>:<span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YAC_HT</span>:<span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UVAC_HT</span>:<span class="ActionScriptDefault_Text">Array</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">YDC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_luminance_nrcodesList</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">std_dc_luminance_valuesList</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">UVDC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodesList</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">std_dc_chrominance_valuesList</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">YAC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_luminance_nrcodesList</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">std_ac_luminance_valuesList</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">UVAC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodesList</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">std_ac_chrominance_valuesList</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">bitcode</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>65535<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">category</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>65535<span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initCategoryNumber</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrlower</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrupper</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 2;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nr</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cat</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">cat</span><span class="ActionScriptOperator">&lt;=</span>15; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">cat</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//Positive numbers
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">nrlower</span>; <span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">nrupper</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> 32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span>;
                    <span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cat</span>;
                    <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cat</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">//Negative numbers
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">=</span><span class="ActionScriptOperator">-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrupper</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">&lt;=</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">nrlower</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> 32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span>;
                    <span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cat</span>;
                    <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrupper</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cat</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">nrlower</span> <span class="ActionScriptOperator">&lt;&lt;=</span> 1;
                <span class="ActionScriptDefault_Text">nrupper</span> <span class="ActionScriptOperator">&lt;&lt;=</span> 1;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// IO functions
</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">byteout</span>:<span class="ActionScriptDefault_Text">ByteArray</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bytenew</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bytepos</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 7;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bs</span>:<span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bs</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">posval</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bs</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">len</span><span class="ActionScriptOperator">-</span>1;
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">posval</span> <span class="ActionScriptOperator">&gt;=</span> 0 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&amp;</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">&lt;&lt;</span> <span class="ActionScriptDefault_Text">posval</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">bytenew</span> <span class="ActionScriptOperator">|=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">&lt;&lt;</span> <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">posval</span><span class="ActionScriptOperator">--</span>;
                <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">--</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytenew</span> <span class="ActionScriptOperator">==</span> 0xFF<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0xFF<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytenew</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">=</span>7;
                    <span class="ActionScriptDefault_Text">bytenew</span><span class="ActionScriptOperator">=</span>0;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">byteout</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">&gt;&gt;</span>8<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>   <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// DCT &amp; quantization core
</span>
<span class="ActionScriptComment">//#define FIX_0_298631336  ((INT32)  2446)    /* FIX(0.298631336) */
</span><span class="ActionScriptComment">//#define FIX_0_390180644  ((INT32)  3196)    /* FIX(0.390180644) */
</span><span class="ActionScriptComment">//#define FIX_0_541196100  ((INT32)  4433)    /* FIX(0.541196100) */
</span><span class="ActionScriptComment">//#define FIX_0_765366865  ((INT32)  6270)    /* FIX(0.765366865) */
</span><span class="ActionScriptComment">//#define FIX_0_899976223  ((INT32)  7373)    /* FIX(0.899976223) */
</span><span class="ActionScriptComment">//#define FIX_1_175875602  ((INT32)  9633)    /* FIX(1.175875602) */
</span><span class="ActionScriptComment">//#define FIX_1_501321110  ((INT32)  12299)    /* FIX(1.501321110) */
</span><span class="ActionScriptComment">//#define FIX_1_847759065  ((INT32)  15137)    /* FIX(1.847759065) */
</span><span class="ActionScriptComment">//#define FIX_1_961570560  ((INT32)  16069)    /* FIX(1.961570560) */
</span><span class="ActionScriptComment">//#define FIX_2_053119869  ((INT32)  16819)    /* FIX(2.053119869) */
</span><span class="ActionScriptComment">//#define FIX_2_562915447  ((INT32)  20995)    /* FIX(2.562915447) */
</span><span class="ActionScriptComment">//#define FIX_3_072711026  ((INT32)  25172)    /* FIX(3.072711026) */
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fDCTQuant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span>:<span class="ActionScriptDefault_Text">IntBlock</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fdtbl</span>:<span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp0</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp1</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp2</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp3</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp4</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp5</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp6</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp7</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp10</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp11</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp12</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tmp13</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d0</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d1</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d2</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d3</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d4</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d5</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d6</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d7</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z1</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">z2</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">z3</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">z4</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">z5</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">row</span>:<span class="ActionScriptDefault_Text">IntBlock</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">col</span>:<span class="ActionScriptDefault_Text">IntBlock</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dataOff</span>:<span class="ActionScriptDefault_Text">IntBlock</span>;
            <span class="ActionScriptComment">/* Pass 1: process rows. */</span>
            <span class="ActionScriptComment">/* Note results are scaled up by sqrt(8) compared to a true DCT; */</span>
            <span class="ActionScriptComment">/* furthermore, we scale the results by 2**2. */</span>
            <span class="ActionScriptDefault_Text">row</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>8; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">row</span>;
                <span class="ActionScriptDefault_Text">d0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">d1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">d2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">d3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">d4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">d5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">d6</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">d7</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;

                <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d7</span>;
                <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d0</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d7</span>;
                <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d6</span>;
                <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d6</span>;
                <span class="ActionScriptDefault_Text">tmp2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d2</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d5</span>;
                <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d2</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d5</span>;
                <span class="ActionScriptDefault_Text">tmp3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d3</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d4</span>;
                <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d3</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d4</span>;

                <span class="ActionScriptComment">/* Even part per LL&amp;M figure 1 --- note that published figure is faulty;
                 * rotator "sqrt(2)*c1" should be "sqrt(2)*c6".
                 */</span>
                <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp3</span>;
                <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp3</span>;
                <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp2</span>;
                <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp2</span>;

                <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp13</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_541196100*/</span>4433<span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">row</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp11</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;&lt;</span> 2;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_765366865*/</span>6270 <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 10*/</span>0x400<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 11;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp11</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;&lt;</span> 2;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_847759065*/</span>15137 <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 10*/</span>0x400<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 11;

                <span class="ActionScriptComment">/* Odd part per figure 8 --- note paper omits factor of sqrt(2).
                 * cK represents cos(K*pi/16).
                 * i0..i3 in the paper are tmp4..tmp7 here.
                 */</span>
                <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp7</span>;
                <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp6</span>;
                <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp6</span>;
                <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp7</span>;
                <span class="ActionScriptDefault_Text">z5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_175875602*/</span>9633; <span class="ActionScriptComment">/* sqrt(2) * c3 */</span>

                <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_298631336*/</span>2446; <span class="ActionScriptComment">/* sqrt(2) * (-c1+c3+c5-c7) */</span>
                <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_2_053119869*/</span>16819; <span class="ActionScriptComment">/* sqrt(2) * ( c1+c3-c5+c7) */</span>
                <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_3_072711026*/</span>25172; <span class="ActionScriptComment">/* sqrt(2) * ( c1+c3+c5-c7) */</span>
                <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_501321110*/</span>12299; <span class="ActionScriptComment">/* sqrt(2) * ( c1+c3-c5-c7) */</span>
                <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_899976223*/</span>7373; <span class="ActionScriptComment">/* sqrt(2) * (c7-c3) */</span>
                <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_2_562915447*/</span>20995; <span class="ActionScriptComment">/* sqrt(2) * (-c1-c3) */</span>
                <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_961570560*/</span>16069; <span class="ActionScriptComment">/* sqrt(2) * (-c3-c5) */</span>
                <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_390180644*/</span>3196; <span class="ActionScriptComment">/* sqrt(2) * (c5-c3) */</span>

                <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">z5</span>;
                <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">z5</span>;

                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 10*/</span>0x400<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 11;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 10*/</span>0x400<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 11;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 10*/</span>0x400<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 11;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 10*/</span>0x400<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 11;

                <span class="ActionScriptDefault_Text">row</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>; <span class="ActionScriptComment">/* advance pointer to next row */</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">/* Pass 2: process columns.
             * We remove the PASS1_BITS scaling, but leave the results scaled up
             * by an overall factor of 8.
             */</span>
            <span class="ActionScriptDefault_Text">col</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>8; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">col</span>;
                <span class="ActionScriptDefault_Text">d0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">d1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">d2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">d3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">d4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">d5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">d6</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">d7</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;

                <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d7</span>;
                <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d0</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d7</span>;
                <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d6</span>;
                <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d6</span>;
                <span class="ActionScriptDefault_Text">tmp2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d2</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d5</span>;
                <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d2</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d5</span>;
                <span class="ActionScriptDefault_Text">tmp3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d3</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">d4</span>;
                <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d3</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">d4</span>;

                <span class="ActionScriptComment">/* Even part per LL&amp;M figure 1 --- note that published figure is faulty;
                 * rotator "sqrt(2)*c1" should be "sqrt(2)*c6".
                 */</span>
                <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp3</span>;
                <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp3</span>;
                <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp2</span>;
                <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp2</span>;

                <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp13</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_541196100*/</span>4433<span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">col</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 1*/</span>0x2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 2;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_765366865*/</span>6270 <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 14*/</span>0x4000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 15;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 1*/</span>0x2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 2;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_847759065*/</span>15137 <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 14*/</span>0x4000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 15;

                <span class="ActionScriptComment">/* Odd part per figure 8 --- note paper omits factor of sqrt(2).
                 * cK represents cos(K*pi/16).
                 * i0..i3 in the paper are tmp4..tmp7 here.
                 */</span>
                <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp7</span>;
                <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp6</span>;
                <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp6</span>;
                <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp7</span>;
                <span class="ActionScriptDefault_Text">z5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_175875602*/</span>9633; <span class="ActionScriptComment">/* sqrt(2) * c3 */</span>

                <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_298631336*/</span>2446; <span class="ActionScriptComment">/* sqrt(2) * (-c1+c3+c5-c7) */</span>
                <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_2_053119869*/</span>16819; <span class="ActionScriptComment">/* sqrt(2) * ( c1+c3-c5+c7) */</span>
                <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_3_072711026*/</span>25172; <span class="ActionScriptComment">/* sqrt(2) * ( c1+c3+c5-c7) */</span>
                <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_501321110*/</span>12299; <span class="ActionScriptComment">/* sqrt(2) * ( c1+c3-c5-c7) */</span>
                <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_899976223*/</span>7373; <span class="ActionScriptComment">/* sqrt(2) * (c7-c3) */</span>
                <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_2_562915447*/</span>20995; <span class="ActionScriptComment">/* sqrt(2) * (-c1-c3) */</span>
                <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_1_961570560*/</span>16069; <span class="ActionScriptComment">/* sqrt(2) * (-c3-c5) */</span>
                <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptComment">/*FIX_0_390180644*/</span>3196; <span class="ActionScriptComment">/* sqrt(2) * (c5-c3) */</span>

                <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">z5</span>;
                <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">z5</span>;

                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 14*/</span>0x4000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 15;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 14*/</span>0x4000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 15;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 14*/</span>0x4000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 15;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">down</span>;
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptComment">/*1 &lt;&lt; 14*/</span>0x4000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;&gt;</span> 15;

                <span class="ActionScriptDefault_Text">col</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>; <span class="ActionScriptComment">/* advance pointer to next column */</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">// Quantize/descale the coefficients
</span>            <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>64; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Apply the quantization and scaling factor &amp; Round to nearest integer
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">qval</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fdtbl</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">fdtbl</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fdtbl</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">temp</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">temp</span>;
                    <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">qval</span> <span class="ActionScriptOperator">&gt;&gt;</span> 1;    <span class="ActionScriptComment">/* for rounding */</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">qval</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">qval</span>;
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> 0;
                    <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">temp</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">qval</span> <span class="ActionScriptOperator">&gt;&gt;</span> 1;    <span class="ActionScriptComment">/* for rounding */</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">qval</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">qval</span>;
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">temp</span>;
                <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">data</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// Chunk writing
</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeAPP0</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0xFFE0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>16<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// length
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x4A<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// J
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x46<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// F
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x49<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// I
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x46<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// F
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// = "JFIF",'\0'
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// versionhi
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// versionlo
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// xyunits
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// xdensity
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// ydensity
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// thumbnwidth
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// thumbnheight
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeSOF0</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">height</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0xFFC0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>17<span class="ActionScriptBracket/Brace">)</span>;   <span class="ActionScriptComment">// length, truecolor YUV JPG
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>8<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// precision
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// nrofcomponents
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// IdY
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x11<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HVY
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// QTY
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// IdU
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x11<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HVU
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// QTU
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// IdV
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x11<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HVV
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// QTV
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeDQT</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0xFFDB<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>132<span class="ActionScriptBracket/Brace">)</span>;       <span class="ActionScriptComment">// length
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>64; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">YTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>64; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">UVTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeDHT</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0xFFC4<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0x01A2<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// length
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;

            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTYDCinfo
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_luminance_nrcodes</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_luminance_nrcodesList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>16; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_luminance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_dc_luminance_nrcodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_luminance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_luminance_values</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_luminance_valuesList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>11; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_luminance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_dc_luminance_values</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_luminance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x10<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTYACinfo
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_luminance_nrcodes</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_luminance_nrcodesList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>16; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_luminance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_ac_luminance_nrcodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_luminance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_luminance_values</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_luminance_valuesList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>161; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_luminance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_ac_luminance_values</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_luminance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTUDCinfo
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodes</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodesList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>16; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_values</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_valuesList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>11; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_chrominance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_dc_chrominance_values</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x11<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTUACinfo
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodes</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodesList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>16; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_values</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_valuesList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>161; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_chrominance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">std_ac_chrominance_values</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_values</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeSOS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0xFFDA<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>12<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// length
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// nrofcomponents
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// IdY
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTY
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// IdU
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x11<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTU
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// IdV
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x11<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTV
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Ss
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0x3f<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Se
</span>            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Bf
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// Core processing
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">DU</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">CDU</span>:<span class="ActionScriptDefault_Text">IntBlock</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fdtbl</span>:<span class="ActionScriptDefault_Text">IntList</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">DC</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">HTDC</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">HTAC</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">EOB</span>:<span class="ActionScriptDefault_Text">BitString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">HTAC</span><span class="ActionScriptBracket/Brace">[</span>0x00<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">M16zeroes</span>:<span class="ActionScriptDefault_Text">BitString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">HTAC</span><span class="ActionScriptBracket/Brace">[</span>0xF0<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DU_DCT</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fDCTQuant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">CDU</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fdtbl</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//ZigZag reorder
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ZigZag</span>:<span class="ActionScriptDefault_Text">IntList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZagList</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>64;<span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DU_DCT</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span>;
                <span class="ActionScriptDefault_Text">ZigZag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                <span class="ActionScriptDefault_Text">DU_DCT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DU_DCT</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Diff</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">DC</span>; <span class="ActionScriptDefault_Text">DC</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptComment">//Encode DC
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Diff</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">HTDC</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Diff might be 0
</span>            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">Diff</span>;
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">HTDC</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;&gt;</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//Encode ACs
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">end0pos</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 63;
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;&amp;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">end0pos</span>;
            <span class="ActionScriptComment">//end0pos = first element in reverse order !=0
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">end0pos</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EOB</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">DC</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">end0pos</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">startpos</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span><span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrzeroes</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">startpos</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span>:<span class="ActionScriptDefault_Text">int</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">nrzeroes</span> <span class="ActionScriptOperator">&gt;=</span> 16 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nrzeroes</span><span class="ActionScriptOperator">/</span>16;
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrmarker</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">nrmarker</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">n</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">nrmarker</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">M16zeroes</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">nrzeroes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrzeroes</span><span class="ActionScriptOperator">&amp;</span>0xF<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> 32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">HTAC</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrzeroes</span><span class="ActionScriptOperator">&lt;&lt;</span>4<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">end0pos</span> <span class="ActionScriptOperator">!=</span> 63 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EOB</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">DC</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">YDUBlock</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntBlock</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create8_8</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">UDUBlock</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntBlock</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create8_8</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">VDUBlock</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IntBlock</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">create8_8</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">fltrRGB2YUV</span>:<span class="ActionScriptDefault_Text">ColorMatrixFilter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ColorMatrixFilter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
             0.29900<span class="ActionScriptOperator">,</span>  0.58700<span class="ActionScriptOperator">,</span>  0.11400<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span>   0<span class="ActionScriptOperator">,</span>
            <span class="ActionScriptOperator">-</span>0.16874<span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span>0.33126<span class="ActionScriptOperator">,</span>  0.50000<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 128<span class="ActionScriptOperator">,</span>
             0.50000<span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span>0.41869<span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span>0.08131<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 128<span class="ActionScriptOperator">,</span>
                   0<span class="ActionScriptOperator">,</span>        0<span class="ActionScriptOperator">,</span>        0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span>   0
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">orgn</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptComment">//private static const rgb_ycc_tab:Array = new Array(2048);
</span>        <span class="ActionScriptComment">//private function init_rgb_ycc_tab():void {
</span>        <span class="ActionScriptComment">//    for (var i:int = 0; i &lt;= 255; i++) {
</span>        <span class="ActionScriptComment">//        rgb_ycc_tab[i]      =  19595 * i;
</span>        <span class="ActionScriptComment">//        rgb_ycc_tab[(i+ 256)&gt;&gt;0] =  38470 * i;
</span>        <span class="ActionScriptComment">//        rgb_ycc_tab[(i+ 512)&gt;&gt;0] =   7471 * i + 0x8000;
</span>        <span class="ActionScriptComment">//        rgb_ycc_tab[(i+ 768)&gt;&gt;0] = -11059 * i;
</span>        <span class="ActionScriptComment">//        rgb_ycc_tab[(i+1024)&gt;&gt;0] = -21709 * i;
</span>                <span class="ActionScriptComment">/* We use a rounding fudge-factor of 0.5-epsilon for Cb and Cr.
                 * This ensures that the maximum output will round to MAXJSAMPLE
                 * not MAXJSAMPLE+1, and thus that we don't have to range-limit.
                 */</span>
        <span class="ActionScriptComment">//        rgb_ycc_tab[(i+1280)&gt;&gt;0] =  32768 * i + 0x807FFF;
</span>                <span class="ActionScriptComment">/*  B=&gt;Cb and R=&gt;Cr tables are the same
                    rgb_ycc_tab[i+R_CR_OFF] = FIX(0.50000) * i    + CBCR_OFFSET + ONE_HALF-1;
                */</span>
        <span class="ActionScriptComment">//        rgb_ycc_tab[(i+1536)&gt;&gt;0] = -27439 * i;
</span>        <span class="ActionScriptComment">//        rgb_ycc_tab[(i+1792)&gt;&gt;0] = - 5329 * i;
</span>        <span class="ActionScriptComment">//    }
</span>        <span class="ActionScriptComment">//}
</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">RGB2YUV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">img</span>:<span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">xpos</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ypos</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YDU</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">YDUBlock</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UDU</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">UDUBlock</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VDU</span>:<span class="ActionScriptDefault_Text">IntBlock</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">VDUBlock</span>;
        <span class="ActionScriptComment">//    var pos:int=0;
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">&lt;</span>8; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">&lt;</span>8; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">P</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPixel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xpos</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">R</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P</span><span class="ActionScriptOperator">&gt;&gt;</span>16<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0xFF<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">G</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P</span><span class="ActionScriptOperator">&gt;&gt;</span> 8<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0xFF<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">B</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P</span>    <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0xFF<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">/* RGB2YUV with ColorMatrixFilter */</span>
                    <span class="ActionScriptDefault_Text">YDU</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">-</span>128;
                    <span class="ActionScriptDefault_Text">UDU</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">G</span><span class="ActionScriptOperator">-</span>128;
                    <span class="ActionScriptDefault_Text">VDU</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">B</span><span class="ActionScriptOperator">-</span>128;
                    <span class="ActionScriptComment">/* float RGB2YUV without ColorMatrixFilter
                    YDU[pos] = ((( 0.29900) * R + ( 0.58700) * G + ( 0.11400) * B)) - 128;
                    UDU[pos] = ((( -0.16874) * R + ( -0.33126) * G + ( 0.50000) * B));
                    VDU[pos] = ((( 0.50000) * R + ( -0.41869) * G + ( -0.08131) * B));
                    */</span>
                    <span class="ActionScriptComment">/* precalculated RGB2YUV without ColorMatrixFilter
                    YDU[pos] = ((rgb_ycc_tab[R]             + rgb_ycc_tab[(G +  256)&gt;&gt;0] + rgb_ycc_tab[(B +  512)&gt;&gt;0]) &gt;&gt; 16)-128;
                    UDU[pos] = ((rgb_ycc_tab[(R +  768)&gt;&gt;0] + rgb_ycc_tab[(G + 1024)&gt;&gt;0] + rgb_ycc_tab[(B + 1280)&gt;&gt;0]) &gt;&gt; 16)-128;
                    VDU[pos] = ((rgb_ycc_tab[(R + 1280)&gt;&gt;0] + rgb_ycc_tab[(G + 1536)&gt;&gt;0] + rgb_ycc_tab[(B + 1792)&gt;&gt;0]) &gt;&gt; 16)-128;
                    */</span>
                    <span class="ActionScriptDefault_Text">YDU</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">YDU</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                    <span class="ActionScriptDefault_Text">UDU</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">UDU</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
                    <span class="ActionScriptDefault_Text">VDU</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">VDU</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">next</span>;
        <span class="ActionScriptComment">//            ++pos;
</span>                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Constructor for JPEGEncoder class
         *
         * @param quality The quality level between 1 and 100 that detrmines the
         * level of compression used in the generated JPEG
         * @param dct The forward DCT method to use,
         * supported methods: JDCT_ISLOW, JDCT_IFAST, JDCT_FLOAT
         * @langversion ActionScript 3.0
         * @playerversion Flash 9.0
         * @tiptext
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">JPEGEncoder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">&lt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">&gt;</span> 100<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">=</span> 100;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sf</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">&lt;</span> 50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>5000 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">quality</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>200 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">quality</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// Create tables
</span>            <span class="ActionScriptDefault_Text">initHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">initCategoryNumber</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">initQuantTables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//init_rgb_ycc_tab();
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Created a JPEG image from the specified BitmapData
         *
         * @param image The BitmapData that will be converted into the JPEG format.
         * @return a ByteArray representing the JPEG encoded image data.
         * @langversion ActionScript 3.0
         * @playerversion Flash 9.0
         * @tiptext
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">encode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">image</span>:<span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ByteArray</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//var img:BitmapData = image;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">img</span>:<span class="ActionScriptDefault_Text">BitmapData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">applyFilter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rect</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">orgn</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fltrRGB2YUV</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">height</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">width</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;

            <span class="ActionScriptComment">// Initialize bit writer
</span>            <span class="ActionScriptDefault_Text">byteout</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">bytenew</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">=</span>7;

            <span class="ActionScriptComment">// Add JPEG headers
</span>            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0xFFD8<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// SOI
</span>            <span class="ActionScriptDefault_Text">writeAPP0</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">writeDQT</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">writeSOF0</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">writeDHT</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">writeSOS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">// Encode 8x8 macroblocks
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DCY</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DCU</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DCV</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ypos</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">height</span>; <span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptOperator">+=</span>8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xpos</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">xpos</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">width</span>; <span class="ActionScriptDefault_Text">xpos</span><span class="ActionScriptOperator">+=</span>8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">RGB2YUV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">xpos</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">DCY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">YDUBlock</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fdtbl_YList</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">DCY</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">YDC_HT</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">YAC_HT</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">DCU</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">UDUBlock</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fdtbl_UVList</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">DCU</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">UVDC_HT</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">UVAC_HT</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">DCV</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VDUBlock</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fdtbl_UVList</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">DCV</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">UVDC_HT</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">UVAC_HT</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">// Do the bit alignment of the EOI marker
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">&gt;=</span> 0 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0xFFD9<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//EOI
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">byteout</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
